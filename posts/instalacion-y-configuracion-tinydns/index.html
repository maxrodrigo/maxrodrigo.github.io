<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><title>Instalación y configuración de TinyDNS [ES] | Max Rodrigo</title><meta property="article:published_time" content="2009-10-14T00:00:00+00:00"><meta property="article:modified_time" content="2009-10-14T00:00:00+00:00"><meta name=robots content="index, follow"><meta name=keywords content><meta name=description content="TinyDNS es el servidor de nombres de djbDNS, una suite de herramientas para DNS, creada por Daniel J. Berstein. Por defecto el servidor solo responde a consultas de las zonas previamente declaradas, no responde consultas inversas ni transferencia de zonas. Para estas otras funcionalidades otra serie de herramientas estan disponibles dentro de la suite. Esta modularidad lo hace muy potente, versatil y rápido.
djbDNS se compone de 6 herramientas:
TinyDNS: Servidor de Nombres."><meta name=author content="Max Rodrigo"><link rel=canonical href=https://www.maxrodrigo.com/posts/instalacion-y-configuracion-tinydns/><link rel=icon href=favicon.ico><link rel=stylesheet href=/scss/style.min.fbce211737a9df2b5c8c62961853bc41e5a9bf6e8097bbf170989532ed966968.css integrity="sha256-+84hFzep3ytcjGKWGFO8QeWpv26Al7vxcJiVMu2WaWg="><meta itemprop=name content="Instalación y configuración de TinyDNS [ES]"><meta itemprop=description content="TinyDNS es el servidor de nombres de djbDNS, una suite de herramientas para DNS, creada por Daniel J. Berstein. Por defecto el servidor solo responde a consultas de las zonas previamente declaradas, no responde consultas inversas ni transferencia de zonas. Para estas otras funcionalidades otra serie de herramientas estan disponibles dentro de la suite. Esta modularidad lo hace muy potente, versatil y rápido.
djbDNS se compone de 6 herramientas:
TinyDNS: Servidor de Nombres."><meta itemprop=datePublished content="2009-10-14T00:00:00+00:00"><meta itemprop=dateModified content="2009-10-14T00:00:00+00:00"><meta itemprop=wordCount content="631"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Instalación y configuración de TinyDNS [ES]"><meta name=twitter:description content="TinyDNS es el servidor de nombres de djbDNS, una suite de herramientas para DNS, creada por Daniel J. Berstein. Por defecto el servidor solo responde a consultas de las zonas previamente declaradas, no responde consultas inversas ni transferencia de zonas. Para estas otras funcionalidades otra serie de herramientas estan disponibles dentro de la suite. Esta modularidad lo hace muy potente, versatil y rápido.
djbDNS se compone de 6 herramientas:
TinyDNS: Servidor de Nombres."><meta property="og:title" content="Instalación y configuración de TinyDNS [ES]"><meta property="og:description" content="TinyDNS es el servidor de nombres de djbDNS, una suite de herramientas para DNS, creada por Daniel J. Berstein. Por defecto el servidor solo responde a consultas de las zonas previamente declaradas, no responde consultas inversas ni transferencia de zonas. Para estas otras funcionalidades otra serie de herramientas estan disponibles dentro de la suite. Esta modularidad lo hace muy potente, versatil y rápido.
djbDNS se compone de 6 herramientas:
TinyDNS: Servidor de Nombres."><meta property="og:type" content="article"><meta property="og:url" content="https://www.maxrodrigo.com/posts/instalacion-y-configuracion-tinydns/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2009-10-14T00:00:00+00:00"><meta property="article:modified_time" content="2009-10-14T00:00:00+00:00"><script async src="https://www.googletagmanager.com/gtag/js?id=G-D07XMVNLNT"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-D07XMVNLNT",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-D07XMVNLNT","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta name=generator content="Hugo 0.101.0"></head><body><header role=main><h1>Max Rodrigo</h1><nav><ul><li><a href=/>~/</a></li><li><a href=/posts/>posts</a></li></ul></nav></header><main><article class=entry><h1>Instalación y configuración de TinyDNS [ES]</h1><div class=meta><ul><li><time datetime=2009-10-14T00:00:00>Oct 14, 2009</time></li></ul><ul></ul></div><div><p>TinyDNS es el servidor de nombres de <a href=http://cr.yp.to/djbdns.html>djbDNS</a>, una suite de herramientas para DNS, creada por <a href=http://cr.yp.to/djb.html>Daniel J. Berstein</a>. Por defecto el servidor solo responde a consultas de las zonas previamente declaradas, no responde consultas inversas ni transferencia de zonas. Para estas otras funcionalidades otra serie de herramientas estan disponibles dentro de la suite. Esta modularidad lo hace muy potente, versatil y rápido.</p><p>djbDNS se compone de 6 herramientas:</p><ul><li>TinyDNS: Servidor de Nombres.</li><li>DNScache: Almacena y resuelve direcciones, como aquellas que TinyDNS no tiene declaradas.</li><li>WallDNS: Resuleve consultas inversas.</li><li>RblDNS: Provee información sobre direcciónes IP.</li><li>AxfrDNS: Responde consultas de tranferencia de zona.</li><li>Axfr-get: Realiza las transferencias de zona.</li></ul><p>djbDNS tiene 2 dependencias, daemontools 0.70+ y ucspi-tcp que debemos instalar antes de continuar.</p><h2 id=setup>Setup</h2><p>Creamos un directorio para almacenar nuestras descargas.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>mkdir /package
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>755</span> /package
</span></span><span style=display:flex><span>cd /package
</span></span></code></pre></div><h2 id=compilar-daemontools>Compilar Daemontools</h2><blockquote><p>Deamontools es la colección de herramientas para el manejo de servicios en UNIX.</p></blockquote><p>Descargamos daemontools 0.76 y descomprimimos.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wget http://cr.yp.to/daemontools/daemontools-0.76.tar.gz
</span></span><span style=display:flex><span>tar xvfz daemontools-0.76.tar.gz
</span></span></code></pre></div><h3 id=compilamos>Compilamos</h3><p>Si estamos trabajando en Linux y no en BSD o Solaris es probable que al compilar recibamos el siguiente error:</p><p><code>/usr/bin/ld: errno: TLS definition in /lib64/libc.so.6 section .tbss mismatches non-TLS reference in envdir.o.</code></p><p>Editamos <code>/package/admin/daemontools-0.76/src/conf--cc</code> e incluimos <code>-include /usr/include/errno.h</code> al final de la primer linea.</p><p>Deberia quedarnos asi:</p><p><code>gcc -O2 -Wimplicit -Wunused -Wcomment -Wchar-subscripts -Wuninitialized -Wshadow -Wcast-qual -Wcast-align -Wwrite-strings -include /usr/include/errno.h</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd admin/daemontools-0.76/
</span></span><span style=display:flex><span>package/install
</span></span></code></pre></div><p>Por defecto la instalación carga <code>svscan</code> a la rutina de incio y agrega <code>SV:12345:respawn:/command/svscanboot</code> a <code>/etc/inittab</code>. Ejecutemos <code>svscan</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>svscan /service &amp;
</span></span></code></pre></div><h2 id=instalación-de-ucspi-tcp>Instalación de ucspi-tcp</h2><blockquote><p><a href=http://cr.yp.to/ucspi-tcp.html>ucspi-tcp</a> es el acronimo de UNIX Client-Server Program Interface for TCP es una herramienta de linea de comando para crear aplicaciones TCP de cliente-servidor.</p></blockquote><p>Descargamos ucspi-tcp 0.88 y descomprimimos.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd /package
</span></span><span style=display:flex><span>wget http://cr.yp.to/ucspi-tcp/ucspi-tcp-0.88.tar.gz
</span></span><span style=display:flex><span>tar xvzf ucspi-tcp-0.88.tar.gz
</span></span></code></pre></div><h3 id=compilamos-1>Compilamos</h3><p>Al igual que daemontools es probable que al compilar recibas un error de <code>libc.so</code>. Editamos <code>/package/ucspi-tcp-0.88/conf-cc</code> y al final de la primer linea agregamos <code>-include /usr/include/errno.h</code>.</p><p>Deberia quedarnos asi:</p><p><code>gcc -O2 -include /usr/include/errno.h</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd ucspi-tcp-0.88/
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>make setup check
</span></span></code></pre></div><h2 id=instalación-de-djbdns-y-tinydns>Instalación de djbDNS y TinyDNS</h2><p>Descargamos y descomprimimos djbDNS.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd /package
</span></span><span style=display:flex><span>wget http://cr.yp.to/djbdns/djbdns-1.05.tar.gz
</span></span><span style=display:flex><span>tar xvzf djbdns-1.05.tar.gz
</span></span><span style=display:flex><span>cd djbdns-1.05/
</span></span></code></pre></div><h3 id=compilamos-2>Compilamos</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>echo gcc -O2 -include /usr/include/errno.h &gt; conf-cc
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>make setup check
</span></span></code></pre></div><p>Ya con djbDNS y sus dependencias creamos dos usuarios: <code>Gtinydns</code> y <code>Gdnslog</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>useradd Gtinydns
</span></span><span style=display:flex><span>useradd Gdnslog
</span></span></code></pre></div><p>Ejecutamos <code>tinydns-conf</code> para crear la carpeta del servicio en <code>/etc/tinydns</code>.</p><blockquote><p>Recuerda correr el commando con la IP publica de tu servidor.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>tinydns-conf Gtinydns Gdnslog /etc/tinydns &lt;public-ip&gt;
</span></span></code></pre></div><blockquote><p>La IP debe estar configurada en el servidor y no debe utilizar DNScache ni algun otro servicio en el puerto 53.
Si se desea usar DNSCache en el mismo servidor se puede utilizar otra interfaz en el mismo servidor.</p></blockquote><p>Le notificamos a <code>svscan</code> del nuevo servicio y usamos <code>svstat</code> para validar que el servicio esté corriendo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ln -s /etc/tinydns /service/tinydns
</span></span><span style=display:flex><span>svstat /service/tinydns
</span></span></code></pre></div><p>Si reciben un <code>supervise</code> error, comprueben que el proceso este corriendo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ps aux | grep sv
</span></span></code></pre></div><p>De no estarlo pueden ejectuarlo manualmente <code>svscan /service &</code></p><p>Re-ejecutar <code>svstat /service/tinydns</code> debería devolver el pid.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>/service/tinydns: up <span style=color:#f92672>(</span>pid <span style=color:#75715e>####) ## seconds</span>
</span></span></code></pre></div><h2 id=delegación-y-zonas>Delegación y zonas</h2><p>Primero debemos configurar en nuestro proovedor de dominios (GoDaddy, Namecheap, etc) nuestros dominios. Registraremos un Nameserver con nuestra IP. Una vez hecho esto, debemos configurar nuestro servidor para que responda a nuestro dominio. Recuerden usar nuestra IP.
Usaremos los commandos <code>add-host</code> y <code>add-alias</code> que se encuentran en el directorio <code>/etc/tinydns/root</code>. Estos comandos editan el archivo <code>/etc/tinydns/root/data</code>. Luego de editado este archivo debemos compilarlo con el comando <code>make</code>.</p><p>Podemos editar el archivo <code>data</code> de manualmente.</p><p>Agreguemos nuestro NS al archivo data y compilemos.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cd /etc/tinydns/root
</span></span><span style=display:flex><span>./add-ns dominio.com 1.2.3.4
</span></span><span style=display:flex><span>make
</span></span></code></pre></div><p>Si quisieramos agregar un nuevo dominio simplemente con add-host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./add-host new-domain.com 1.2.3.4
</span></span></code></pre></div><p>Una alternativa es editar el archivo <code>data</code> manualmente con la siguiente forma:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#e6db74>`</span><span style=color:#f92672>=</span>tiger.heaven.af.mil:1.8.7.5<span style=color:#e6db74>`</span> para add-host, o <span style=color:#e6db74>`</span>+www.heaven.af.mil:1.8.7.4<span style=color:#e6db74>`</span> para add-alias.
</span></span></code></pre></div><p>No olvides compilar el archivo data al finalizar la edición.</p></div></article></main><footer><span>&copy; 2022 <a href=https://www.maxrodrigo.com/>Max Rodrigo</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
      <a href=https://github.com/maxrodrigo/hugo-theme-wisdom/ rel=noopener target=_blank>Wisdom</a></span></footer></body></html>